{
  "yahoo-clean-spam": {
    "name": "Clean Yahoo Spam",
    "description": "Log into Yahoo Mail and empty the spam folder",
    "dangerous": true,
    "triggers": [
      "clean yahoo spam",
      "yahoo spam",
      "clean my spam",
      "empty spam"
    ],
    "session_state_path": "sessions/yahoo_state.json",
    "steps": [
      {
        "type": "browser",
        "description": "Open Yahoo Mail (inbox)",
        "action": "goto",
        "url": "https://mail.yahoo.com/d",
        "timeout_ms": 60000,
        "wait_until": "domcontentloaded"
      },
      {
        "type": "browser",
        "description": "Wait for mailbox UI to load",
        "action": "wait_for",
        "selector": "a[data-test-folder-name='Inbox'], a[aria-label='Inbox'], [data-test-id='compose-button'], button[aria-label='Compose'], [data-test-id='mail-search']",
        "timeout_ms": 300000
      },
      {
        "type": "browser",
        "description": "Save logged-in session (for next time)",
        "action": "save_storage_state",
        "path": "sessions/yahoo_state.json"
      },
      {
        "type": "browser",
        "description": "Click Spam folder",
        "action": "click",
        "selector": "a[data-test-folder-name='Spam'], a[aria-label='Spam']",
        "timeout_ms": 30000
      },
      {
        "type": "browser",
        "description": "Empty spam folder (if available)",
        "action": "click_optional",
        "selector": "button[data-test-id='empty-folder'], button[title='Empty Spam']",
        "timeout_ms": 15000
      },
      {
        "type": "browser",
        "description": "Confirm empty spam (if prompted)",
        "action": "click_optional",
        "selector": "button[data-test-id='primary-button'], button[data-test-id='confirmation-dialog-ok-button']",
        "timeout_ms": 15000
      },
      {
        "type": "browser",
        "description": "Select all spam (fallback)",
        "action": "click_optional",
        "selector": "[data-test-id='checkbox-select-all'], [data-test-id='checkbox-selectAll'], input[aria-label='Select all']",
        "timeout_ms": 15000
      },
      {
        "type": "browser",
        "description": "Delete selected (fallback)",
        "action": "click_optional",
        "selector": "[data-test-id='toolbar-delete'], button[title='Delete'], [data-test-id='delete']",
        "timeout_ms": 15000
      }
    ],
    "login_site": "yahoo",
    "created": "2025-12-19",
    "type": "browser"
  },
  "yahoo-login": {
    "name": "Yahoo Mail: Login",
    "description": "Open Yahoo Mail and ensure you're logged in (reuses saved session if available).",
    "triggers": [
      "log into my yahoo mail",
      "log in to my yahoo mail",
      "login to yahoo mail",
      "login to my yahoo mail",
      "login yahoo mail",
      "open yahoo mail",
      "yahoo mail login",
      "open my yahoo mail",
      "go to yahoo mail",
      "check yahoo mail"
    ],
    "session_state_path": "sessions/yahoo_state.json",
    "headless": false,
    "steps": [
      {
        "type": "browser",
        "description": "Open Yahoo Mail",
        "action": "goto",
        "url": "https://mail.yahoo.com/d",
        "timeout_ms": 60000,
        "wait_until": "domcontentloaded"
      },
      {
        "type": "browser",
        "description": "Wait for mailbox UI to load (confirms login success)",
        "action": "wait_for",
        "selector": "a[data-test-folder-name='Inbox'], a[aria-label='Inbox'], [data-test-id='compose-button'], button[aria-label='Compose'], [data-test-id='mail-search']",
        "timeout_ms": 300000
      },
      {
        "type": "browser",
        "description": "Save logged-in session for future use",
        "action": "save_storage_state",
        "path": "sessions/yahoo_state.json"
      },
      {
        "type": "browser",
        "description": "Capture evidence screenshot",
        "action": "screenshot"
      }
    ],
    "login_site": "yahoo",
    "created": "2025-12-19",
    "type": "browser"
  },
  "yahoo-app-password-setup": {
    "name": "Yahoo Mail: App Password Setup",
    "description": "Open Yahoo Account Security and guide you to App Passwords for IMAP/SMTP (manual login).",
    "triggers": [
      "setup yahoo app password",
      "yahoo app password",
      "enable yahoo imap",
      "enable yahoo smtp",
      "yahoo mail api setup"
    ],
    "login_site": "yahoo",
    "session_state_path": "sessions/yahoo_state.json",
    "headless": false,
    "steps": [
      {
        "type": "browser",
        "description": "Open Yahoo Account Security",
        "action": "goto",
        "url": "https://login.yahoo.com/account/security",
        "timeout_ms": 60000,
        "wait_until": "domcontentloaded"
      },
      {
        "type": "browser",
        "description": "Brief pause for page load",
        "action": "sleep",
        "seconds": 1
      },
      {
        "type": "browser",
        "description": "Wait for App passwords tab (after you sign in)",
        "action": "wait_for",
        "selector": "[role='tab']:has-text('App passwords')",
        "timeout_ms": 300000
      },
      {
        "type": "browser",
        "description": "Open App Passwords (best effort)",
        "action": "click_optional",
        "selector": "[role='tab']:has-text('App passwords')"
      },
      {
        "type": "browser",
        "description": "Click Create/Generate app password (best effort)",
        "action": "click_optional",
        "text": "Create app password"
      },
      {
        "type": "browser",
        "description": "Open App Passwords (alternate label)",
        "action": "click_optional",
        "text": "Generate app password"
      },
      {
        "type": "browser",
        "description": "Open App Passwords (alternate label)",
        "action": "click_optional",
        "text": "Generate and manage app passwords"
      },
      {
        "type": "browser",
        "description": "Open App Passwords (alternate label)",
        "action": "click_optional",
        "text": "App passwords"
      },
      {
        "type": "browser",
        "description": "If app name prompt appears, fill and generate (manual ok)",
        "action": "pause_if_visible",
        "selector": "input[name='appName'], input#appName, input[aria-label='App name']",
        "timeout_ms": 120000,
        "message": "If the App Name field is visible, enter 'DrCodePT' and click Generate/Continue, then copy the password."
      },
      {
        "type": "browser",
        "description": "Pause so you can generate/copy the app password",
        "action": "pause_for_user",
        "message": "Generate the app password (label it 'DrCodePT'), copy it, then press Enter."
      },
      {
        "type": "browser",
        "description": "Capture screenshot (optional)",
        "action": "screenshot"
      },
      {
        "type": "python",
        "description": "Save app password from clipboard into yahoo_imap credentials",
        "code": "import subprocess, sys\nfrom agent.memory.credentials import get_credential, save_credential\n\ncreds = get_credential('yahoo') or {}\nusername = (creds.get('username') or '').strip()\nif not username:\n    print('Missing yahoo username (run: Cred: yahoo)')\n    sys.exit(1)\n\ntry:\n    pw = subprocess.check_output(['powershell','-NoLogo','-NoProfile','-Command','Get-Clipboard'], text=True).strip()\nexcept Exception as exc:\n    print(f'Failed to read clipboard: {exc}')\n    sys.exit(1)\n\nif not pw:\n    print('Clipboard is empty. Copy the app password and rerun setup.')\n    sys.exit(1)\n\npw = pw.replace(' ', '').replace('-', '')\nif not pw:\n    print('Clipboard app password is empty after cleanup. Copy it again and rerun setup.')\n    sys.exit(1)\n\nsave_credential('yahoo_imap', username, pw)\nprint('Saved yahoo_imap app password from clipboard.')\n"
      }
    ],
    "created": "2025-12-19",
    "type": "browser"
  },
  "yahoo-imap-test": {
    "name": "Yahoo Mail: IMAP Read Test",
    "description": "List the latest Yahoo inbox headers via IMAP (read-only).",
    "triggers": [
      "test yahoo imap",
      "check yahoo inbox",
      "list yahoo inbox headers",
      "read yahoo inbox headers",
      "yahoo inbox headers"
    ],
    "steps": [
      {
        "type": "python",
        "description": "List latest Yahoo inbox headers",
        "code": "import sys\nfrom pathlib import Path\n\nrepo = Path.cwd() / 'agent'\nif not repo.is_dir():\n    raise SystemExit('Could not find repo root with agent/ directory. Run from repo root.')\n\nsys.path.insert(0, str(Path.cwd()))\nfrom agent.integrations import yahoo_mail\n\nitems = yahoo_mail.list_messages(limit=5, folder='INBOX')\nif not items:\n    print('No messages found or unable to read inbox.')\nelse:\n    for i, msg in enumerate(items, 1):\n        print(f\"{i}. {msg.get('date','')} | {msg.get('from','')} | {msg.get('subject','')}\")\n"
      }
    ],
    "created": "2025-12-20",
    "type": "python"
  },
  "learn-agent-help": {
    "name": "Learn (Agent Help)",
    "description": "Lists installed playbooks and opens the local AGENTS.md/README for reference.",
    "triggers": [
      "agent help",
      "show playbooks",
      "list playbooks",
      "what can you do"
    ],
    "steps": [
      {
        "type": "shell",
        "description": "List playbook files under any 'playbooks' directory.",
        "allow_shell": true,
        "command": "$dirs=@(); if(Test-Path .\\playbooks){$dirs+=(Resolve-Path .\\playbooks).Path}; $dirs+=Get-ChildItem -Recurse -Directory -ErrorAction SilentlyContinue | Where-Object { $_.Name -ieq 'playbooks' } | Sort-Object FullName | ForEach-Object { $_.FullName }; $dirs=$dirs | Sort-Object -Unique; if(-not $dirs -or $dirs.Count -eq 0){Write-Warning 'No playbooks directory found.'} else {foreach($d in $dirs){Write-Host \"`nPlaybooks in $d\"; Get-ChildItem -Path $d -File -Filter *.json -ErrorAction SilentlyContinue | Sort-Object Name | Select-Object Name, FullName | Format-Table -AutoSize}}"
      },
      {
        "type": "shell",
        "description": "Open AGENTS.md or README.md (prefers repo root).",
        "allow_shell": true,
        "command": "$target=$null; if(Test-Path .\\AGENTS.md){$target=(Resolve-Path .\\AGENTS.md).Path} elseif(Test-Path .\\README.md){$target=(Resolve-Path .\\README.md).Path} else {$target=(Get-ChildItem -Recurse -File -ErrorAction SilentlyContinue -Filter AGENTS.md | Sort-Object FullName | Select-Object -First 1).FullName; if(-not $target){$target=(Get-ChildItem -Recurse -File -ErrorAction SilentlyContinue -Filter README.md | Sort-Object FullName | Select-Object -First 1).FullName}}; if(-not $target){Write-Warning 'No AGENTS.md or README.md found.'} else {Write-Host \"Opening $target\"; Start-Process notepad.exe $target}"
      }
    ],
    "created": "2025-12-19T05:28:15.123876"
  },
  "setup-google-apis": {
    "name": "Google APIs: Setup OAuth2 (Tasks, Gmail, Calendar)",
    "description": "Google OAuth2 setup using Desktop Commander (real Chrome)",
    "triggers": [
      "setup google apis",
      "setup google tasks",
      "setup gmail api",
      "setup google calendar",
      "enable google apis",
      "google api setup",
      "connect google tasks",
      "connect gmail",
      "connect google calendar"
    ],
    "headless": false,
    "steps": [
      {
        "type": "python",
        "description": "Research: web_search and plan for OAuth setup",
        "code": "from pathlib import Path\nfrom agent.autonomous.tools.builtins import WebSearchArgs, web_search\nfrom agent.autonomous.config import RunContext\n\nquery = 'create Google Cloud OAuth credentials'\nrun_dir = Path('agent') / 'runs' / 'treys_agent'\nrun_dir.mkdir(parents=True, exist_ok=True)\nctx = RunContext(run_id='setup_google_apis_search', run_dir=run_dir, workspace_dir=run_dir, profile=None, usage=None)\nresult = web_search(ctx, WebSearchArgs(query=query, max_results=5))\nresults = []\nif getattr(result, 'success', False) and isinstance(result.output, dict):\n    results = result.output.get('results') or []\nprint('=== Web Search Results ===')\nfor r in results:\n    title = r.get('title') or ''\n    url = r.get('url') or ''\n    print(f'- {title} | {url}')\nprint('')\nplan = [\n    'Open Google Cloud Console and select/create a project.',\n    'Enable APIs: Google Tasks API, Gmail API, Google Calendar API.',\n    'Open APIs & Services > Credentials.',\n    'Create Credentials > OAuth client ID (Desktop app).',\n    'Download the client JSON to agent/memory/google_credentials.json.'\n]\nprint('=== Plan (from search results) ===')\nfor i, step in enumerate(plan, 1):\n    print(f'{i}. {step}')\n"
      },
      {
        "type": "mcp",
        "description": "Launch real Chrome (Desktop Commander)",
        "tool": "Windows-MCP:App-Tool",
        "args": {
          "mode": "launch",
          "name": "chrome"
        }
      },
      {
        "type": "mcp",
        "description": "Open Google Cloud APIs dashboard",
        "tool": "Windows-MCP:App-Tool",
        "args": {
          "mode": "launch",
          "name": "chrome",
          "url": "https://console.cloud.google.com/apis/dashboard"
        }
      },
      {
        "type": "mcp",
        "description": "Capture UI state (login check)",
        "tool": "Windows-MCP:State-Tool",
        "args": {}
      },
      {
        "type": "mcp",
        "description": "Scrape page content (login check)",
        "tool": "Windows-MCP:Scrape-Tool",
        "args": {
          "mode": "visible_text",
          "output_path": "agent/runs/treys_agent/google_oauth/login_check.txt"
        }
      },
      {
        "type": "python",
        "description": "Pause only if login/2FA appears",
        "code": "from pathlib import Path\ntext_path = Path('agent/runs/treys_agent/google_oauth/login_check.txt')\nif text_path.exists():\n    text = text_path.read_text(encoding='utf-8', errors='ignore').lower()\n    if any(k in text for k in ('sign in', 'choose an account', '2-step', '2-step verification', 'verify', 'login')):\n        input('Login required. Press Enter after you complete 2FA.')\n"
      },
      {
        "type": "mcp",
        "description": "Open Google Tasks API library",
        "tool": "Windows-MCP:App-Tool",
        "args": {
          "mode": "launch",
          "name": "chrome",
          "url": "https://console.cloud.google.com/apis/library/tasks.googleapis.com"
        }
      },
      {
        "type": "mcp",
        "description": "Enable Google Tasks API (if needed)",
        "tool": "Windows-MCP:Click-Tool",
        "args": {
          "text": "Enable",
          "match": "contains",
          "optional": true
        }
      },
      {
        "type": "mcp",
        "description": "Open Gmail API library",
        "tool": "Windows-MCP:App-Tool",
        "args": {
          "mode": "launch",
          "name": "chrome",
          "url": "https://console.cloud.google.com/apis/library/gmail.googleapis.com"
        }
      },
      {
        "type": "mcp",
        "description": "Enable Gmail API (if needed)",
        "tool": "Windows-MCP:Click-Tool",
        "args": {
          "text": "Enable",
          "match": "contains",
          "optional": true
        }
      },
      {
        "type": "mcp",
        "description": "Open Google Calendar API library",
        "tool": "Windows-MCP:App-Tool",
        "args": {
          "mode": "launch",
          "name": "chrome",
          "url": "https://console.cloud.google.com/apis/library/calendar-json.googleapis.com"
        }
      },
      {
        "type": "mcp",
        "description": "Enable Google Calendar API (if needed)",
        "tool": "Windows-MCP:Click-Tool",
        "args": {
          "text": "Enable",
          "match": "contains",
          "optional": true
        }
      },
      {
        "type": "mcp",
        "description": "Open Credentials page",
        "tool": "Windows-MCP:App-Tool",
        "args": {
          "mode": "launch",
          "name": "chrome",
          "url": "https://console.cloud.google.com/apis/credentials"
        }
      },
      {
        "type": "mcp",
        "description": "Click Create credentials",
        "tool": "Windows-MCP:Click-Tool",
        "args": {
          "text": "Create credentials",
          "match": "contains"
        }
      },
      {
        "type": "mcp",
        "description": "Select OAuth client ID",
        "tool": "Windows-MCP:Click-Tool",
        "args": {
          "text": "OAuth client ID",
          "match": "contains"
        }
      },
      {
        "type": "mcp",
        "description": "Choose Desktop app type",
        "tool": "Windows-MCP:Click-Tool",
        "args": {
          "text": "Desktop app",
          "match": "contains"
        }
      },
      {
        "type": "mcp",
        "description": "Set OAuth client name",
        "tool": "Windows-MCP:Type-Tool",
        "args": {
          "text": "DrCodePT"
        }
      },
      {
        "type": "mcp",
        "description": "Create OAuth client",
        "tool": "Windows-MCP:Click-Tool",
        "args": {
          "text": "Create",
          "match": "exact"
        }
      },
      {
        "type": "mcp",
        "description": "Download client JSON",
        "tool": "Windows-MCP:Click-Tool",
        "args": {
          "text": "Download JSON",
          "match": "contains"
        }
      },
      {
        "type": "mcp",
        "description": "Capture UI state (download check)",
        "tool": "Windows-MCP:State-Tool",
        "args": {}
      },
      {
        "type": "python",
        "description": "Capture downloaded credentials.json",
        "code": "from pathlib import Path\nimport shutil\nimport sys\n\ntarget = Path('agent/memory/google_credentials.json')\ntarget.parent.mkdir(parents=True, exist_ok=True)\n\ndef _latest_in(dir_path: Path):\n    if not dir_path.is_dir():\n        return None\n    files = sorted(dir_path.glob('*.json'), key=lambda p: p.stat().st_mtime, reverse=True)\n    for f in files:\n        name = f.name.lower()\n        if 'client_secret' in name or 'credentials' in name:\n            return f\n    return None\n\nsrc = _latest_in(Path.home() / 'Downloads')\nif not src:\n    print('ERROR: No credentials JSON found in Downloads.')\n    sys.exit(1)\n\nshutil.copy2(src, target)\nprint(f'Saved credentials JSON to {target} (from {src})')\n"
      },
      {
        "type": "python",
        "description": "Verify credentials.json exists",
        "code": "from pathlib import Path\nimport sys\n\ncreds_file = Path('agent/memory/google_credentials.json')\nif not creds_file.exists():\n    print('ERROR: credentials.json not found at agent/memory/google_credentials.json')\n    print('Please download it from Google Cloud Console and save it there.')\n    sys.exit(1)\n\nprint('✓ Found credentials.json')\n"
      },
      {
        "type": "python",
        "description": "Run OAuth2 flow and save token",
        "code": "import json\nimport sys\nfrom pathlib import Path\n\ntry:\n    from google_auth_oauthlib.flow import InstalledAppFlow\n    from agent.memory.credentials import save_credential\nexcept ImportError as e:\n    print(f'Missing dependencies: {e}')\n    print('Run: pip install google-auth google-auth-oauthlib google-auth-httplib2 google-api-python-client')\n    sys.exit(1)\n\nSCOPES = [\n    'https://www.googleapis.com/auth/tasks',\n    'https://www.googleapis.com/auth/gmail.readonly',\n    'https://www.googleapis.com/auth/gmail.modify',\n    'https://www.googleapis.com/auth/calendar',\n    'https://www.googleapis.com/auth/calendar.events'\n]\n\ncreds_file = Path('agent/memory/google_credentials.json')\nif not creds_file.exists():\n    print('ERROR: credentials.json not found')\n    sys.exit(1)\n\nprint('Starting OAuth2 flow...')\nprint('A browser window will open for authentication.')\nprint('Sign in and authorize the app.')\n\nflow = InstalledAppFlow.from_client_secrets_file(str(creds_file), SCOPES)\ncreds = flow.run_local_server(port=0)\n\ntoken_data = {\n    'token': creds.token,\n    'refresh_token': creds.refresh_token,\n    'token_uri': creds.token_uri,\n    'client_id': creds.client_id,\n    'client_secret': creds.client_secret,\n    'scopes': creds.scopes\n}\n\nsave_credential('google_apis', 'token', json.dumps(token_data))\nprint('✓ OAuth2 token saved to credential store')\nprint('✓ Google APIs ready to use!')\n"
      },
      {
        "type": "python",
        "description": "Test Google Tasks API",
        "code": "import sys\nfrom pathlib import Path\n\nsys.path.insert(0, str(Path.cwd()))\nfrom agent.integrations import google_apis\n\nprint('\\n=== Testing Google Tasks API ===')\ntry:\n    tasks = google_apis.list_tasks(max_results=5)\n    if tasks:\n        print(f'✓ Found {len(tasks)} tasks:')\n        for i, task in enumerate(tasks, 1):\n            print(f\"  {i}. {task.get('title', 'Untitled')}\")\n    else:\n        print('✓ Connected (no tasks found)')\nexcept Exception as e:\n    print(f'✗ Error: {e}')\n"
      },
      {
        "type": "python",
        "description": "Test Gmail API",
        "code": "import sys\nfrom pathlib import Path\n\nsys.path.insert(0, str(Path.cwd()))\nfrom agent.integrations import google_apis\n\nprint('\\n=== Testing Gmail API ===')\ntry:\n    messages = google_apis.list_gmail_messages(max_results=3)\n    if messages:\n        print(f'✓ Found {len(messages)} messages')\n    else:\n        print('✓ Connected (no messages found)')\nexcept Exception as e:\n    print(f'✗ Error: {e}')\n"
      },
      {
        "type": "python",
        "description": "Test Google Calendar API",
        "code": "import sys\nfrom pathlib import Path\n\nsys.path.insert(0, str(Path.cwd()))\nfrom agent.integrations import google_apis\n\nprint('\\n=== Testing Google Calendar API ===')\ntry:\n    events = google_apis.list_calendar_events(max_results=5)\n    if events:\n        print(f'✓ Found {len(events)} upcoming events:')\n        for i, event in enumerate(events, 1):\n            print(f\"  {i}. {event.get('summary', 'Untitled')}\")\n    else:\n        print('✓ Connected (no upcoming events)')\nexcept Exception as e:\n    print(f'✗ Error: {e}')\n\nprint('\\n=== Setup Complete ===')\nprint('You can now use Google Tasks, Gmail, and Calendar APIs!')\n"
      }
    ],
    "created": "2025-12-20",
    "type": "browser"
  }
}